---
title: D√©ploiement
description: Guide de d√©ploiement de Foundation Builder
---

import { Hero } from "@/blocks/landing-page/hero/ui.tsx";

<div className="border-2 border-gray-400 rounded-lg shadow-2xl w-full mx-auto  bg-gray-50">
  <div className="bg-gray-300 px-3 py-2 text-xs font-mono text-gray-600 border-b flex items-center justify-between">
    <span>localhost:3000/hero-preview</span>
    <div className="flex gap-1">
      <div className="w-3 h-3 bg-red-500 rounded-full"></div>
      <div className="w-3 h-3 bg-yellow-500 rounded-full"></div>
      <div className="w-3 h-3 bg-green-500 rounded-full"></div>
    </div>
  </div>
  <div className="h-96 overflow-y-auto bg-white rounded-b-lg">
    <div className="p-4">
      <Hero
        badge="üíï Pour les couples et amis"
        title="Transformez vos conversations en souvenirs pr√©cieux"
        description="Capturez les moments dr√¥les, touchants ou m√©morables de vos conversations et affichez-les dans de magnifiques cadres photo personnalis√©s. Gardez vos √©changes les plus pr√©cieux pour toujours."
      />
    </div>
  </div>
</div>
---

# Guide de d√©ploiement

Ce guide vous accompagne dans le d√©ploiement de Foundation Builder sur diff√©rentes plateformes.

## üöÄ Vercel (Recommand√©)

Vercel est la plateforme recommand√©e pour d√©ployer des applications Next.js.

### 1. Pr√©paration

```bash
# Build de test local
npm run build

# V√©rification des erreurs
npm run lint
```

### 2. Configuration Vercel

Connectez votre repository GitHub √† Vercel
Configurez les variables d'environnement dans le dashboard Vercel
dsjffsdj
dsfjnsdkjf

**Variables requises :**

```bash
# Firebase
FIREBASE_API_KEY=your_api_key
FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
FIREBASE_PROJECT_ID=your_project_id
FIREBASE_STORAGE_BUCKET=your_project.appspot.com
FIREBASE_MESSAGING_SENDER_ID=123456789
FIREBASE_APP_ID=1:123456789:web:abcdef

# Stripe
STRIPE_SECRET_KEY=sk_live_...
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...

# Better Auth
BETTER_AUTH_SECRET=your_production_secret
BETTER_AUTH_URL=https://your-domain.vercel.app

# Email
RESEND_API_KEY=re_...
```

### 3. Configuration des domaines

```bash
# Ajouter un domaine personnalis√©
vercel domains add your-domain.com

# Configurer le domaine
vercel domains inspect your-domain.com
```

### 4. Webhooks Stripe

Configurez les webhooks Stripe pour pointer vers votre domaine :

```
https://your-domain.vercel.app/api/payments/webhook
```

**√âv√©nements √† √©couter :**

- `payment_intent.succeeded`
- `payment_intent.payment_failed`
- `customer.subscription.created`
- `customer.subscription.updated`
- `customer.subscription.deleted`

## üåê Netlify

### 1. Configuration build

Cr√©ez un fichier `netlify.toml` :

```toml
[build]
  command = "npm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "18"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

### 2. Variables d'environnement

Configurez les variables dans le dashboard Netlify :

```bash
# M√™mes variables que Vercel
FIREBASE_API_KEY=your_api_key
STRIPE_SECRET_KEY=sk_live_...
# ... autres variables
```

### 3. D√©ploiement

```bash
# Installation de Netlify CLI
npm install -g netlify-cli

# Connexion
netlify login

# D√©ploiement
netlify deploy --prod
```

## üê≥ Docker

### 1. Dockerfile

```dockerfile
# syntax=docker.io/docker/dockerfile:1

FROM node:18-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

# Install dependencies
COPY package.json package-lock.json* ./
RUN npm ci --only=production

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Build the application
RUN npm run build

# Production image
FROM base AS runner
WORKDIR /app

ENV NODE_ENV=production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT=3000
ENV HOSTNAME="0.0.0.0"

CMD ["node", "server.js"]
```

### 2. Docker Compose

```yaml
version: "3.8"

services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - FIREBASE_API_KEY=${FIREBASE_API_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      # ... autres variables
    volumes:
      - ./logs:/app/logs
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app
    restart: unless-stopped
```

### 3. D√©ploiement

```bash
# Build de l'image
docker build -t foundation-builder .

# Lancement du conteneur
docker run -p 3000:3000 --env-file .env foundation-builder

# Avec Docker Compose
docker-compose up -d
```

## ‚òÅÔ∏è AWS

### 1. AWS Amplify

```yaml
# amplify.yml
version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
```

### 2. AWS Lambda (Serverless)

```typescript
// serverless.yml
service: foundation-builder

provider:
  name: aws
  runtime: nodejs18.x
  region: eu-west-1
  environment:
    FIREBASE_API_KEY: ${env:FIREBASE_API_KEY}
    STRIPE_SECRET_KEY: ${env:STRIPE_SECRET_KEY}

functions:
  app:
    handler: server.handler
    events:
      - http:
          path: /{proxy+}
          method: ANY
      - http:
          path: /
          method: ANY
```

## üèóÔ∏è Railway

### 1. Configuration

Cr√©ez un fichier `railway.json` :

```json
{
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "npm start",
    "healthcheckPath": "/api/health"
  }
}
```

### 2. Variables d'environnement

Configurez les variables dans le dashboard Railway :

```bash
NODE_ENV=production
FIREBASE_API_KEY=your_api_key
STRIPE_SECRET_KEY=sk_live_...
# ... autres variables
```

## üîß Configuration de production

### 1. Optimisations Next.js

```typescript
// next.config.ts
const nextConfig = {
  output: "standalone",
  images: {
    domains: ["images.unsplash.com"],
    formats: ["image/webp", "image/avif"],
  },
  compress: true,
  poweredByHeader: false,
  generateEtags: false,
  httpAgentOptions: {
    keepAlive: true,
  },
};
```

### 2. Variables d'environnement

```bash
# Production
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-domain.com

# Monitoring
SENTRY_DSN=your_sentry_dsn
ANALYTICS_ID=your_analytics_id

# Performance
REDIS_URL=redis://your-redis-url
```

### 3. Monitoring

```typescript
// lib/monitoring.ts
import { init } from "@sentry/nextjs";

init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1,
});
```

## üìä Monitoring et logs

### 1. Vercel Analytics

```typescript
// app/layout.tsx
import { Analytics } from "@vercel/analytics/react";

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Analytics />
      </body>
    </html>
  );
}
```

### 2. Logs structur√©s

```typescript
// lib/logger.ts
import winston from "winston";

export const logger = winston.createLogger({
  level: "info",
  format: winston.format.combine(winston.format.timestamp(), winston.format.json()),
  transports: [
    new winston.transports.Console(),
    new winston.transports.File({ filename: "error.log", level: "error" }),
  ],
});
```

## üîí S√©curit√©

### 1. Headers de s√©curit√©

```typescript
// next.config.ts
const securityHeaders = [
  {
    key: "X-DNS-Prefetch-Control",
    value: "on",
  },
  {
    key: "Strict-Transport-Security",
    value: "max-age=63072000; includeSubDomains; preload",
  },
  {
    key: "X-Frame-Options",
    value: "SAMEORIGIN",
  },
  {
    key: "X-Content-Type-Options",
    value: "nosniff",
  },
  {
    key: "Referrer-Policy",
    value: "origin-when-cross-origin",
  },
];
```

### 2. Validation des webhooks

```typescript
// app/api/payments/webhook/route.ts
import { stripe } from "@/lib/stripe";
import { headers } from "next/headers";

export async function POST(req: Request) {
  const body = await req.text();
  const signature = headers().get("stripe-signature");

  try {
    const event = stripe.webhooks.constructEvent(body, signature, process.env.STRIPE_WEBHOOK_SECRET!);

    // Traitement de l'√©v√©nement
  } catch (err) {
    return new Response("Webhook signature verification failed", { status: 400 });
  }
}
```

## üöÄ Checklist de d√©ploiement

- [ ] Variables d'environnement configur√©es
- [ ] Build local r√©ussi
- [ ] Tests passent
- [ ] Domaines configur√©s
- [ ] SSL activ√©
- [ ] Webhooks configur√©s
- [ ] Monitoring activ√©
- [ ] Backup configur√©
- [ ] Documentation mise √† jour
